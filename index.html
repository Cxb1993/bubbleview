<!DOCTYPE html>
<html>

<head>
  <title>BubbleView</title>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="css/bootstrap-material-design.min.css">
  <link rel="stylesheet" type="text/css" href="css/ripples.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      padding-top: 70px;
    }
  </style>

</head>

<body>
  <div class="navbar navbar-info navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          <span><img alt="Brand" src="img/logo.png" width="30"></span> &nbsp;BubbleView
        </a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li class="active"><a href="#demo">Demo</a></li>
          <li><a href="#code">Code</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="panel panel-default">
      <div class="panel-body">
        <h2>BubbleView: replacing eye-tracking to crowdsource image importance</h2>
        <br>
        <div class="container-fluid">
          <div class="row">
            <div class="col-xs-4 col-sm-2 col-md-1 text-center">
              <img class="img-circle img-responsive center-block" src="img/people/nam2.png"> NamWook
              <br>Kim*
            </div>
            <div class="col-xs-4 col-sm-2 col-md-1 text-center">
              <img class="img-circle img-responsive center-block" src="img/people/zoya2.png"> Zoya
              <br>Bylinskii*
            </div>
            <div class="col-xs-4 col-sm-2 col-md-1 text-center">
              <img class="img-circle img-responsive center-block" src="img/people/michelle2.png"> Michelle
              <br>Borkin
            </div>
            <div class="col-xs-4 col-sm-2 col-md-1 text-center">
              <img class="img-circle img-responsive center-block" src="img/people/gajos2.png"> Krzysztof
              <br>Gajos
            </div>
            <div class="col-xs-4 col-sm-2 col-md-1 text-center">
              <img class="img-circle img-responsive center-block" src="img/people/aude2.png"> Aude
              <br>Oliva
            </div>
            <div class="col-xs-4 col-sm-2 col-md-1 text-center">
              <img class="img-circle img-responsive center-block" src="img/people/fredo2.png"> Fredo
              <br>Durand
            </div>
            <div class="col-xs-4 col-sm-2 col-md-1 text-center">
              <img class="img-circle img-responsive center-block" src="img/people/hp2.png"> Hanspeter
              <br>Pfister
            </div>
          </div>
        </div>

        <br>
        <p>We present BubbleView, an alternative methodology for tracking human visual attention using mouse clicks. Participants are presented with a series of blurred images and can click to reveal “bubbles” - small, circular areas of the image at normal
          resolution, similar to having a confined area of focus like the eye fovea. We evaluated the BubbleView methodology on a variety of image types: information visualizations, graphic designs, static webpages, and natural images, and compared the
          clicks collected to eye fixations collected in controlled lab settings. We found that BubbleView can be used to successfully approximate eye fixations on different images types, and analyzed the effect of experimental parameters including image
          blur, bubble sizes, task type, and viewing time. We also compared BubbleView to related methodologies for crowdsourcing mouse movements and explicit importance annotations. Our methodology can be used to collect image importance, as it is designed
          to measure which information people consciously choose to examine. We present our experimental tool which can be launched online to easily crowdsource the data collection of attention and importance on new images.</p>
        <br>
        <p>
          Submitted to <em>ACM Transactions on Computer-Human Interaction (TOCHI)</em>
          <br> *Equal contribution
        </p>
        <a href="javascript:void(0)" class="btn btn-raised btn-default btn-sm">PDF</a>
        <a href="javascript:void(0)" class="btn btn-raised btn-default btn-sm">Bibtex</a>
        <br>
      </div>
    </div>
    <div id="demo" class="panel panel-default">
      <div class="panel-body">
        <h2>Live Demo</h2>
        <h3>BubbleView Interface</h3>
        <p>Choose a parameter setting, and click & describe the image. You can check your result through the monitoring interface below in real time.</p>

        <div class="row">
          <div class="col-md-2">
            <label>Bubble Radius</label>
          </div>
          <div class="col-md-10">
            <form name='radiusForm'>
              <label class="radio-inline">
                <input type="radio" name="radius" value="30" checked> 30
              </label>
              <label class="radio-inline">
                <input type="radio" name="radius" value="40"> 40
              </label>
              <label class="radio-inline">
                <input type="radio" name="radius" value="50"> 50
              </label>
              <label class="radio-inline">
                <input type="radio" name="radius" value="60"> 60
              </label>
              <label class="radio-inline">
                <input type="radio" name="radius" value="70"> 70
              </label>
            </form>
          </div>
        </div>
        <div class="row">
          <div class="col-md-2">
            <label>Blur Radius</label>
          </div>
          <div class="col-md-10">
            <form name='blurForm'>
              <label class="radio-inline">
                <input type="radio" name="blur" value="30" checked> 30
              </label>
              <label class="radio-inline">
                <input type="radio" name="blur" value="40"> 40
              </label>
              <label class="radio-inline">
                <input type="radio" name="blur" value="50"> 50
              </label>
              <label class="radio-inline">
                <input type="radio" name="blur" value="60"> 60
              </label>
              <label class="radio-inline">
                <input type="radio" name="blur" value="70"> 70
              </label>
            </form>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div id="canvas-area" style="display:inline-block;float:left;">
              <canvas id="canvas" width="500" height="500"></canvas>
            </div>
            <form style="display:inline-block;margin-left:20px;width:300px;">
              <span class="badge"><span id="click-count">0</span> clicks</span>
              <span class="badge"><span id="char-count">0</span> characters</span>
              <div class="form-group label-floating">
                <label for="desc" class="control-label">Describe the image in as much detail as possible...</label>
                <textarea id="desc" name="desc" class="form-control" rows="20" ></textarea>
              </div>
            </form>
          </div>
        </div>
        <h3>Monitoring Interface</h3>
        <div class="row">
          <div class="col-xs-12 col-sm-3 col-md-3 col-lg-2">
            <div class="togglebutton">
              <label>
                <input id="see-original" type="checkbox" checked> See Original
              </label>
            </div>
          </div>
          <div class="col-xs-12 col-sm-3 col-md-3 col-lg-2">
            <div class="togglebutton">
              <label>
                <input id="see-bubbles" type="checkbox" checked> See Bubbles (
                <span id="curr-bubbles">0</span>/<span id="total-bubbles">0</span>)
              </label>
            </div>
          </div>
          <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
            <label> Timespan </label>
            <div id="slider" style="margin-top:0px;" class="slider shor slider-material-orange"></div>

          </div>

        </div>
        <div class="row">
          <div class="col-md-12">
            <div id="canvas-area" style="display:inline-block;float:left;">
              <canvas id="result-canvas" width="500" height="500"></canvas>
            </div>
            <form style="display:inline-block;margin-left:20px;width:300px;">
              <div class="form-group" style="margin-top:0px;">
                <textarea id="result-desc" name="desc" class="form-control" rows="20" placeholder="You description will appear here..." disabled></textarea>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>






  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="js/material.min.js"></script>
  <script src="js/stackblur.js"></script>
  <script src="js/nouislider.min.js"></script>
  <script src="js/diff.min.js"></script>
  <script src="js/bubbleview.js"></script>

  <script>
    var radius, blur;
    var clickCount = 0;
    var clicks = [];
    var descs = [];
    var originalDesc, updatedDesc;
    var slider;
    var seeBubbles, seeOriginal;

    function logClick(log) {
      clickCount++;
      $("#click-count").text(clickCount);
      console.log(log);
      clicks.push(log);

      resetMonitoring();
    }
    function logDescChange() {
      console.log("out focus");
      updatedDesc = $("#desc").val();
      var diff = JsDiff.diffChars(originalDesc, updatedDesc);
      console.log(diff);
      descs.push({
        diff: diff,
        timestamp: $.now()
      });

      resetMonitoring();
    }
    function onSliderChange(value, handle){
      console.log(value);
      console.log(parseInt(handle));
      resetMonitoring(parseInt(handle));
    }
    function onCheckSeeBubbles(){
      seeBubbles = this.checked;
      resetMonitoring();
    }
    function onCheckSeeOriginal(){
      seeOriginal = this.checked;
      resetMonitoring();
    }
    function resetBubbleView(){
      //  reset bubbleview interface
      bv.setup('img/sample.png', 'canvas', radius, blur, logClick);
      $("#desc").val('');
      $('#char-count').text(0);
      $("#click-count").text(0);
      clicks = [];
      descs = [];
      resetMonitoring();

    }
    function resetMonitoring(maxTime){
      //  reset monitoring interface
      //  reset slider
      if (clicks.length<=0){
        slider = $("#slider").noUiSlider({
          start: 0,
          connect: "lower",
          range: {
            min: 0,
            max: 0
          }
        }, true);
        bv.monitor('img/sample.png', 'result-canvas', seeBubbles, seeOriginal);
      }else{
        var times = clicks.concat(descs).sort(function(a,b){
          return a.timestamp - b.timestamp;
        }).map(function(d){
          return d.timestamp;
        });

        $("#slider").noUiSlider({
          start: times[times.length-1],
          connect: "lower",
          range: {
            min: times[0],
            max: times[times.length-1]
          }
        }, true);
        bv.monitor('img/sample.png', 'result-canvas', seeBubbles, seeOriginal,
          clicks, maxTime?maxTime:times[times.length-1]);
      }



    }
    $(document).ready(function() {
      $.material.init();


      // bubbleview interface setup
      radius = $("input[name='radius']:checked").val();
      blur = $("input[name='blur']:checked").val();
      seeBubbles = $("#see-bubbles").prop("checked");
      seeOriginal = $("#see-original").prop("checked");
      console.log(seeBubbles + ", " + seeOriginal);
      $("#slider").noUiSlider({
        start: 0,
        connect: "lower",
        range: {
          min: 0,
          max: 0
        }
      });
      resetBubbleView();


      var radiBtns = document.radiusForm.radius;
      for (var i=0; i<radiBtns.length; i++){
        radiBtns[i].onclick=function(){
          radius = parseInt(this.value);
          resetBubbleView();
        }
      }
      var blurBtns = document.blurForm.blur;
      for (var i=0; i<blurBtns.length; i++){
        blurBtns[i].onclick=function(){
          blur = parseInt(this.value);
          resetBubbleView();
        }
      }
      // description change tracking
      $('#desc').keyup(function() {
        $('#char-count').text($('#desc').val().length);
      })

      $("#desc").focusin(function() {
        console.log("in focus");
        originalDesc = $("#desc").val();
      });
      $("#desc").focusout(logDescChange);

      $("#slider").change(onSliderChange);
      $('#see-original').change(onCheckSeeOriginal);
      $('#see-bubbles').change(onCheckSeeBubbles);




    })

  </script>
</body>

</html>
